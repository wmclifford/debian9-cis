---
# file: tasks/section_5.yml
# ======================================================================
# Section 5
# Access, Authentication and Authorization
# ======================================================================

# ----------------------------------------------------------------------
# Section 5.1
# Configure cron
# ----------------------------------------------------------------------

- name: "SCORED | 5.1.1 | PATCH | Ensure cron daemon is enabled"
  service:
    name: "{{ cron_service[ansible_os_family] }}"
    enabled: yes
  when:
    - debian9cis_rule_5_1_1
  tags:
    - level1
    - scored
    - patch
    - services
    - cron
    - rule_5.1.1

- name: "SCORED | 5.1.2 | PATCH | Ensure permissions on /etc/crontab are configured"
  file:
    path: /etc/crontab
    owner: root
    group: root
    mode: "0600"
  when:
    - debian9cis_rule_5_1_2
  tags:
    - level1
    - scored
    - patch
    - cron
    - rule_5.1.2

- name: "SCORED | 5.1.3 | PATCH | Ensure permissions on /etc/cron.hourly are configured"
  file:
    path: /etc/cron.hourly
    state: directory
    owner: root
    group: root
    mode: "0700"
  when:
    - debian9cis_rule_5_1_3
  tags:
    - level1
    - scored
    - patch
    - cron
    - rule_5.1.3

- name: "SCORED | 5.1.4 | PATCH | Ensure permissions on /etc/cron.daily are configured"
  file:
    path: /etc/cron.daily
    state: directory
    owner: root
    group: root
    mode: "0700"
  when:
    - debian9cis_rule_5_1_4
  tags:
    - level1
    - scored
    - patch
    - cron
    - rule_5.1.4

- name: "SCORED | 5.1.5 | PATCH | Ensure permissions on /etc/cron.weekly are configured"
  file:
    path: /etc/cron.weekly
    state: directory
    owner: root
    group: root
    mode: "0700"
  when:
    - debian9cis_rule_5_1_5
  tags:
    - level1
    - scored
    - patch
    - cron
    - rule_5.1.5

- name: "SCORED | 5.1.6 | PATCH | Ensure permissions on /etc/cron.monthly are configured"
  file:
    path: /etc/cron.monthly
    state: directory
    owner: root
    group: root
    mode: "0700"
  when:
    - debian9cis_rule_5_1_6
  tags:
    - level1
    - scored
    - patch
    - cron
    - rule_5.1.6

- name: "SCORED | 5.1.7 | PATCH | Ensure permissions on /etc/cron.d are configured"
  file:
    path: /etc/cron.d
    state: directory
    owner: root
    group: root
    mode: "0700"
  when:
    - debian9cis_rule_5_1_7
  tags:
    - level1
    - scored
    - patch
    - cron
    - rule_5.1.7

- name: "SCORED | 5.1.8 | PATCH | Ensure at/cron is restricted to authorized users"
  block:
    - file:
        path: /etc/at.deny
        state: absent
    - file:
        path: /etc/at.allow
        state: touch
        owner: root
        group: root
        mode: "0600"
    - file:
        path: /etc/cron.deny
        state: absent
    - file:
        path: /etc/cron.allow
        state: touch
        owner: root
        group: root
        mode: "0600"
  when:
    - debian9cis_rule_5_1_8
  tags:
    - level1
    - scored
    - patch
    - cron
    - rule_5.1.8

# ----------------------------------------------------------------------
# Section 5.2
# SSH Server Configuration
# ----------------------------------------------------------------------

# ----------------------------------------------------------------------
# Section 5.3
# Configure PAM
# ----------------------------------------------------------------------

# ----------------------------------------------------------------------
# Section 5.4
# User Accounts and Environment
# ----------------------------------------------------------------------

# ----------------------------------------------------------------------
# Section 5.5
# root login
# ----------------------------------------------------------------------

# ----------------------------------------------------------------------
# Section 5.6
# su access
# ----------------------------------------------------------------------

# End -- Section 5
# ======================================================================
